(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{203:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return m}));var r=n(72),i=n.n(r),a=n(113),o=n.n(a),u=n(28),s=n(146),c=n(206),d=(n(452),n(208)),l=n(215),p=null;function m(){return f.apply(this,arguments)}function f(){return(f=o()(i.a.mark((function t(){var n,r,a=arguments;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=a.length>0&&void 0!==a[0]&&a[0],null!==p&&!n){t.next=7;break}return r=[c.a],p=Object(u.d)(l.a,void 0,Object(u.c)(u.a.apply(void 0,r),Object(s.autoRehydrate)())),t.next=7,new e((function(e){Object(s.persistStore)(p,{keyPrefix:"app ",transforms:[d.a]},(function(){e(p)}))}));case 7:return t.abrupt("return",e.resolve(p));case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}}).call(this,n(49))},208:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(112);var i=Object(r.createTransform)((function(e){return e.withMutations((function(e){e.delete("maxPointId")}))}),(function(e){return e.withMutations((function(e){e.delete("maxPointId")}))}),{whitelist:["route"]})},214:function(e,t,n){"use strict";(function(e){var r=n(65),i=n.n(r),a=n(66),o=n.n(a),u=n(67),s=n.n(u),c=n(68),d=n.n(c),l=n(69),p=n.n(l),m=n(1),f=n.n(m),g=n(4),v=n.n(g),h=n(88),b=n.n(h),y=n(7);var R=function(t){function n(e){var t;return i()(this,n),(t=s()(this,d()(n).call(this,e))).mapContainer=f.a.createRef(),t.map=null,t.routePolyline=null,t.placemarks=[],t.readyPromise=null,t}return p()(n,t),o()(n,[{key:"componentDidMount",value:function(){var t=this;this.readyPromise=new e((function(e){return b.a.ready(e)})).then((function(){return t.createMap()}))}},{key:"componentDidUpdate",value:function(e){var t=this.props.points;t.length===e.points.length&&JSON.stringify(t)===JSON.stringify(e.points)||this.updateRoute(e.points)}},{key:"componentWillUnmount",value:function(){this.destroyMap()}},{key:"createMap",value:function(){var e=this,t=this.props,n=t.latitude,r=t.longitude,i=t.zoom,a=this.map=new b.a.Map(this.mapContainer.current,{center:[n,r],zoom:i,controls:[]}),o=a.controls;o.add("typeSelector",{position:{top:y.m,right:y.m}}),o.add("zoomControl",{position:{top:y.m,left:y.m}}),a.events.add("actionend",(function(){var t=a.getCenter(),n=a.getZoom();e.props.setCenter(t[0],t[1]),e.props.setZoom(n)})),this.createRoute()}},{key:"destroyMap",value:function(){this.destroyRoute(),this.map.destroy(),this.map=null}},{key:"createRoute",value:function(){for(var e=this.props.points,t=[],n=0;n<e.length;n++){var r=e[n],i=r.latitude,a=r.longitude;t.push([i,a]),this.createPlacemark(r)}this.routePolyline=new b.a.Polyline(t,{},{strokeColor:"#aa0000",strokeWidth:3}),this.map.geoObjects.add(this.routePolyline)}},{key:"updateRoute",value:function(e){for(var t=this,n=this.props.points,r=[],i=function(r){var i=e[r].id;n.find((function(e){return e.id===i}))||t.destroyPlacemark(i)},a=0;a<e.length;a++)i(a);var o=function(i){var a=n[i],o=a.id,u=a.latitude,s=a.longitude;r.push([u,s]),e.find((function(e){return e.id===o}))||t.createPlacemark(a)};for(a=0;a<n.length;a++)o(a);this.routePolyline.geometry.setCoordinates(r)}},{key:"destroyRoute",value:function(){for(var e=this.props.points,t=0;t<e.length;t++){var n=e[t];this.destroyPlacemark(n.id)}this.map.geoObjects.remove(this.routePolyline),this.routePolyline=null}},{key:"createPlacemark",value:function(e){var t=this,n=e.id,r=e.name,i=e.latitude,a=e.longitude,o=new b.a.Placemark([i,a],{balloonContent:r},{draggable:!0});o.events.add("drag",(function(){var e=o.geometry.getCoordinates(),r=e[0],i=e[1];t.props.relocatePoint(n,r,i)})),this.placemarks.push({id:n,geoObject:o}),this.map.geoObjects.add(o)}},{key:"destroyPlacemark",value:function(e){var t=this.placemarks.findIndex((function(t){return t.id===e})),n=this.placemarks[t].geoObject;this.map.geoObjects.remove(n),this.placemarks.splice(t,1)}},{key:"render",value:function(){var e=this.props.id;return f.a.createElement("div",{id:e,className:"map",ref:this.mapContainer})}}]),n}(m.Component);R.propTypes={id:v.a.string.isRequired,latitude:v.a.number.isRequired,longitude:v.a.number.isRequired,zoom:v.a.number.isRequired,points:v.a.arrayOf(v.a.shape({id:v.a.number.isRequired,name:v.a.string.isRequired,latitude:v.a.number.isRequired,longitude:v.a.number.isRequired})).isRequired,setCenter:v.a.func.isRequired,setZoom:v.a.func.isRequired,relocatePoint:v.a.func.isRequired},R.defaultProps={id:"map"},t.a=R}).call(this,n(49))},215:function(e,t,n){"use strict";var r=n(209),i=n(31),a=n(7),o=i.default.fromJS({latitude:a.j,longitude:a.k,zoom:a.l}),u=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case a.g:var n=t.latitude;return e.set("latitude",n);case a.h:var r=t.longitude;return e.set("longitude",r);case a.f:var i=t.latitude,u=t.longitude;return e.merge({latitude:i,longitude:u});case a.i:var s=t.zoom;return e.set("zoom",s);default:return e}},s=i.default.fromJS({points:[],error:""}),c={map:u,route:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case a.a:var n=t.name,r=t.latitude,o=t.longitude;if(!n.trim())return e.set("error","Имя точки маршрута не может быть пустым.");var u=e.get("points"),c=e.get("maxPointId",null);null===c&&(c=u.reduce((function(e,t){var n=t.get("id");return n>e?n:e}),0));var d=u.get(-1,null);if(null!==d&&d.get("latitude")===r&&d.get("longitude")===o)return e.set("error","Координаты новой точки маршрута не могут быть такими же, как у предыдущей точки.");var l=c+1;return e.merge({maxPointId:l,points:u.push(i.default.fromJS({id:l,name:n.trim(),latitude:r,longitude:o})),error:""});case a.d:var p=t.id,m=t.latitude,f=t.longitude,g=e.get("points"),v=g.findIndex((function(e){return e.get("id")===p}));return-1===v?e:e.set("points",g.mergeIn([v],{latitude:m,longitude:f}));case a.c:var h=t.sourceIndex,b=t.destinationIndex;if(h===b)return e;var y=e.get("points"),R=y.get(h);return e.set("points",y.delete(h).insert(b,R));case a.e:var E=t.id,O=e.get("points"),P=O.findIndex((function(e){return e.get("id")===E}));return-1===P?e:e.merge({points:O.delete(P),error:""});default:return e}}},d=Object(r.combineReducers)(c);t.a=d},216:function(e,t,n){n(217),n(189),e.exports=n(493)},446:function(e,t,n){},452:function(e,t,n){"use strict";n(207)},493:function(e,t,n){"use strict";n.r(t);var r=n(72),i=n.n(r),a=n(113),o=n.n(a),u=n(1),s=n.n(u),c=n(109),d=n(22),l=n(71),p=(n(446),n(203)),m=n(7),f=function(e,t){return{type:m.c,sourceIndex:e,destinationIndex:t}};var g=function(e){return{onDragEnd:function(t){var n=t.source,r=t.destination;if(r&&n.droppableId===r.droppableId&&n.index!==r.index)switch(r.droppableId){case m.b:e.dispatch(f(n.index,r.index))}}}},v=n(65),h=n.n(v),b=n(66),y=n.n(b),R=n(67),E=n.n(R),O=n(68),P=n.n(O),k=n(87),j=n.n(k),x=n(69),I=n.n(x),C=n(4),q=n.n(C),T=function(e){function t(e){var n;return h()(this,t),(n=E()(this,P()(t).call(this,e))).onSubmit=n.onSubmit.bind(j()(n)),n.nameRef=s.a.createRef(),n}return I()(t,e),y()(t,[{key:"componentDidUpdate",value:function(e){this.props.pointsCount>e.pointsCount&&(this.nameRef.current.value="")}},{key:"render",value:function(){var e=this.props.error,t=e?s.a.createElement("div",{className:"route-form-error"},e):"";return s.a.createElement("form",{className:"route-form",onSubmit:this.onSubmit},s.a.createElement("input",{ref:this.nameRef,className:"route-form-input",type:"text"}),t)}},{key:"onSubmit",value:function(e){e.preventDefault();var t=this.nameRef.current.value,n=this.props;(0,n.addPoint)(t,n.latitude,n.longitude)}}]),t}(u.Component);T.propTypes={latitude:q.a.number.isRequired,longitude:q.a.number.isRequired,pointsCount:q.a.number.isRequired,error:q.a.string,addPoint:q.a.func.isRequired};var w=T,N=n(36),_=function(e){return e.get("map")},S=Object(N.a)(_,(function(e){return e.get("latitude")})),M=Object(N.a)(_,(function(e){return e.get("longitude")})),D=Object(N.a)(_,(function(e){return e.get("zoom")})),z=n(210),U=n.n(z),A=function(e){return e.get("route")},J=Object(N.a)(A,(function(e){return e.get("points")})),L=Object(N.a)(J,(function(e){return e.map((function(e){return e.get("id")}))})),Z=Object(N.a)(J,(function(e){return e.size})),B=Object(N.a)(J,(function(e){return U()((function(t){return e.find((function(e){return e.get("id")===t}))||null}))})),V=Object(N.a)(A,(function(e){return e.get("error")})),W=Object(d.b)((function(e){return{latitude:S(e),longitude:M(e),pointsCount:Z(e),error:V(e)}}),{addPoint:function(e,t,n){return{type:m.a,name:e,latitude:t,longitude:n}}})(w),G=n(70),H=n.n(G),F=n(116),K=n.n(F),Q=n(117),X=n.n(Q),Y=n(147),$=function(e){function t(e){var n;return h()(this,t),(n=E()(this,P()(t).call(this,e))).onRemoveClick=n.onRemoveClick.bind(j()(n)),n}return I()(t,e),y()(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.id,r=t.index,i=t.point,a=i.name,o=i.latitude,u=i.longitude;return s.a.createElement(l.b,{draggableId:"draggable-route-list-item-".concat(n),index:r},(function(t,n){var r=X()({"route-list-item":!0,"route-list-item-dragging":n.isDragging});return s.a.createElement("li",K()({ref:t.innerRef},t.draggableProps,t.dragHandleProps,{className:r,style:t.draggableProps.style}),s.a.createElement("div",null,s.a.createElement("div",{className:"route-list-item-name"},a),s.a.createElement("div",{className:"route-list-item-coordinates"},s.a.createElement("span",null,Object(Y.a)(o,{degrees:!0}))," ",s.a.createElement("span",null,Object(Y.b)(u,{degrees:!0})))),s.a.createElement("div",null,s.a.createElement("span",{className:"route-list-item-remove",onClick:e.onRemoveClick,title:"Удалить"},"×")))}))}},{key:"onRemoveClick",value:function(){var e=this.props;(0,e.removePoint)(e.id)}}]),t}(u.PureComponent);$.propTypes={id:q.a.number.isRequired,index:q.a.number.isRequired,point:q.a.shape({name:q.a.string.isRequired,latitude:q.a.number.isRequired,longitude:q.a.number.isRequired}).isRequired,removePoint:q.a.func.isRequired};var ee=$,te=Object(d.b)((function(e,t){return{point:B(e)(t.id)}}),{removePoint:function(e){return{type:m.e,id:e}}})(H()(ee)),ne=function(e){var t=e.pointIds;return s.a.createElement(l.c,{droppableId:m.b,direction:"vertical"},(function(e,n){var r=X()({"route-list":!0,"route-list-dragging-over":n.isDraggingOver});return s.a.createElement("ul",K()({ref:e.innerRef},e.droppableProps,{className:r}),t.map((function(e,t){return s.a.createElement(te,{key:e,id:e,index:t})})),e.placeholder)}))};ne.propTypes={pointIds:q.a.arrayOf(q.a.number).isRequired};var re=ne,ie=Object(d.b)((function(e){return{pointIds:L(e)}}))(H()(re)),ae=function(){return s.a.createElement("div",{className:"sidebar"},s.a.createElement("div",{className:"sidebar-header"},"Маршрут"),s.a.createElement("div",{className:"sidebar-content"},s.a.createElement(W,null),s.a.createElement(ie,null)))},oe=n(214),ue=Object(d.b)((function(e){return{latitude:S(e),longitude:M(e),zoom:D(e),points:J(e)}}),{setCenter:function(e,t){return{type:m.f,latitude:e,longitude:t}},setZoom:function(e){return{type:m.i,zoom:e}},relocatePoint:function(e,t,n){return{type:m.d,id:e,latitude:t,longitude:n}}})(H()(oe.a)),se=function(){return s.a.createElement("div",{className:"app"},s.a.createElement(ae,null),s.a.createElement(ue,null))};document.addEventListener("DOMContentLoaded",o()(i.a.mark((function e(){var t,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(p.a)();case 2:t=e.sent,n=g(t),Object(c.render)(s.a.createElement(d.a,{store:t},s.a.createElement(l.a,{onDragEnd:n.onDragEnd},s.a.createElement(se,null))),document.getElementById("root"));case 5:case"end":return e.stop()}}),e)}))))},7:function(e,t,n){"use strict";n.d(t,"g",(function(){return r})),n.d(t,"h",(function(){return i})),n.d(t,"f",(function(){return a})),n.d(t,"i",(function(){return o})),n.d(t,"a",(function(){return u})),n.d(t,"d",(function(){return s})),n.d(t,"c",(function(){return c})),n.d(t,"e",(function(){return d})),n.d(t,"b",(function(){return l})),n.d(t,"j",(function(){return p})),n.d(t,"k",(function(){return m})),n.d(t,"l",(function(){return f})),n.d(t,"m",(function(){return g}));var r="SET_MAP_LATITUDE",i="SET_MAP_LONGITUDE",a="SET_MAP_CENTER",o="SET_MAP_ZOOM",u="ADD_ROUTE_POINT",s="RELOCATE_ROUTE_POINT",c="MOVE_ROUTE_POINT",d="REMOVE_ROUTE_POINT",l="DROPPABLE_ROUTE_LIST",p=57.6261,m=39.8845,f=13,g=10},88:function(e,t){e.exports=ymaps}},[[216,1,2]]]);